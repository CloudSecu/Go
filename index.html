<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Acc√®s s√©curis√©</title>
</head>
<body>

<h2>Acc√®s prot√©g√©</h2>

<input type="password" id="password" placeholder="Mot de passe">
<br><br>
<button onclick="decrypt()">D√©verrouiller</button>

<div id="content"></div>

<script>

// üîê Base de donn√©es locale des liens chiffr√©s
const encryptedLinks = {
    "Aj8U": "KOrHlzF0+ROWhW0mD+eLEl5ck8aWGrgSaex8MZkioVrx5Qb5YyytKnZVfwv8tmW5HAwxxdMhb25VqdDpYswMaqzcKr7AUYeO+MHPsvKJrt4Yua+eUkr1wJ2yPwb2fi3tvShDX1gE6w=="
};

async function decrypt() {

    const id = location.hash.substring(1);

    if (!encryptedLinks[id]) {
        alert("Lien invalide.");
        return;
    }

    const encryptedData = encryptedLinks[id];
    const password = document.getElementById("password").value;

    try {
        const data = Uint8Array.from(atob(encryptedData), c => c.charCodeAt(0));
        const salt = data.slice(0, 16);
        const iv = data.slice(16, 28);
        const encrypted = data.slice(28);

        const encoder = new TextEncoder();

        const keyMaterial = await crypto.subtle.importKey(
            "raw",
            encoder.encode(password),
            "PBKDF2",
            false,
            ["deriveKey"]
        );

        const key = await crypto.subtle.deriveKey(
            {
                name: "PBKDF2",
                salt: salt,
                iterations: 250000,
                hash: "SHA-256"
            },
            keyMaterial,
            { name: "AES-GCM", length: 256 },
            true,
            ["decrypt"]
        );

        const decrypted = await crypto.subtle.decrypt(
            { name: "AES-GCM", iv: iv },
            key,
            encrypted
        );

        const payload = JSON.parse(new TextDecoder().decode(decrypted));

        document.getElementById("content").innerHTML =
            `<iframe src="${payload.url}" width="100%" height="600px"></iframe>`;

    } catch (e) {
        alert("Mot de passe incorrect.");
    }
}
</script>

</body>
</html>
